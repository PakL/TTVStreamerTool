

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>JSDoc: mod/toolui.js</title>

    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="./build/entry.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Muli:100,400,700|Oswald:300|Inconsolata,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
    <link type="text/css" rel="stylesheet" href="styles/app.min.css">
    <link type="text/css" rel="stylesheet" href="styles/iframe.css">
</head>

<body>
    <div id="stickyNavbarOverlay"></div>
    <div class="top-navbar">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                     
                        <img src="img/logomark-white.svg" alt="logo">
                    
                     
                        <h1 class="navbar-item">TTVStreamerTool</h1>
                    
                    <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                 
                <div class="navbar-menu">
                    <div class="navbar-end">
                    
                        <div class="navbar-item">
                            <a href="https://github.com/PakL/TTVStreamerTool" target="_blank">Github</a>
                        </div>
                    
                        <div class="navbar-item">
                            <a href="https://pakl.dev/" target="_blank">pakl.dev</a>
                        </div>
                    
                        <div class="navbar-item">
                            <a href="https://dieweltzockt.de/" target="_blank">Die Welt Zockt</a>
                        </div>
                    
                    </div>
                </div>
                
            </nav>
        </div>
    </div>
    <div class="container">
        <div class="columns">
            <div class="column is-3" id="sidebarNav">
                <div class="sidebar">
                    <nav>
                        <h2><a href="index.html">Home</a></h2><div class="category"><h3>Tutorials</h3><ul><li><a href="tutorial-Getting Started.html">Getting Started</a></li><li><a href="tutorial-Streamdeck Shortcuts.html">Streamdeck Shortcuts</a></li></ul><h3>Classes</h3><ul><li><a href="Addons.html">Addons</a></li><li><a href="Channel.html">Channel</a></li><li><a href="Chat.html">Chat</a></li><li><a href="Cockpit.html">Cockpit</a></li><li><a href="Follows.html">Follows</a></li><li><a href="Overlays.html">Overlays</a></li><li><a href="ToolSettings.html">ToolSettings</a></li><li><a href="ToolUI.html">ToolUI</a></li><li><a href="TTVLogin.html">TTVLogin</a></li><li><a href="TTVTool.html">TTVTool</a></li><li><a href="TwitchChat.html">TwitchChat</a></li><li><a href="TwitchHelix.html">TwitchHelix</a></li><li><a href="TwitchTv.html">TwitchTv</a></li><li><a href="TwPubSub.html">TwPubSub</a></li><li><a href="UIPage.html">UIPage</a></li></ul><h3>Events</h3><ul><li><a href="Channel.html#event:channeloffline">channeloffline</a></li><li><a href="Channel.html#event:channelonline">channelonline</a></li><li><a href="Channel.html#event:gamechange">gamechange</a></li><li><a href="Channel.html#event:statuschange">statuschange</a></li><li><a href="Channel.html#event:viewers">viewers</a></li><li><a href="Chat.html#event:autohostingyou">autohostingyou</a></li><li><a href="Chat.html#event:chatmessage">chatmessage</a></li><li><a href="Chat.html#event:cheer">cheer</a></li><li><a href="Chat.html#event:clearchat">clearchat</a></li><li><a href="Chat.html#event:clearuser">clearuser</a></li><li><a href="Chat.html#event:connected">connected</a></li><li><a href="Chat.html#event:hostingyou">hostingyou</a></li><li><a href="Chat.html#event:join">join</a></li><li><a href="Chat.html#event:names">names</a></li><li><a href="Chat.html#event:part">part</a></li><li><a href="Chat.html#event:roomstate">roomstate</a></li><li><a href="Chat.html#event:sendmessage">sendmessage</a></li><li><a href="Chat.html#event:usernotice">usernotice</a></li><li><a href="Chat.html#event:userstate">userstate</a></li><li><a href="Cockpit.html#event:channelleft">channelleft</a></li><li><a href="Cockpit.html#event:channelopen">channelopen</a></li><li><a href="Follows.html#event:follow">follow</a></li><li><a href="Overlays.html#event:command">command</a></li><li><a href="Overlays.html#event:hotkeys-unregistered">hotkeys-unregistered</a></li><li><a href="TTVLogin.html#event:complete">complete</a></li><li><a href="TTVTool.html#event:exit">exit</a></li><li><a href="TTVTool.html#event:load">load</a></li><li><a href="TwitchChat.html#event:action">action</a></li><li><a href="TwitchChat.html#event:autohostingyou">autohostingyou</a></li><li><a href="TwitchChat.html#event:capack">capack</a></li><li><a href="TwitchChat.html#event:clearchat">clearchat</a></li><li><a href="TwitchChat.html#event:clearmsg">clearmsg</a></li><li><a href="TwitchChat.html#event:clearuser">clearuser</a></li><li><a href="TwitchChat.html#event:close">close</a></li><li><a href="TwitchChat.html#event:connect">connect</a></li><li><a href="TwitchChat.html#event:error">error</a></li><li><a href="TwitchChat.html#event:hostingyou">hostingyou</a></li><li><a href="TwitchChat.html#event:incoming">incoming</a></li><li><a href="TwitchChat.html#event:join">join</a></li><li><a href="TwitchChat.html#event:message">message</a></li><li><a href="TwitchChat.html#event:mode">mode</a></li><li><a href="TwitchChat.html#event:mode+">mode+</a></li><li><a href="TwitchChat.html#event:mode-">mode-</a></li><li><a href="TwitchChat.html#event:motd">motd</a></li><li><a href="TwitchChat.html#event:names">names</a></li><li><a href="TwitchChat.html#event:notice">notice</a></li><li><a href="TwitchChat.html#event:outgoing">outgoing</a></li><li><a href="TwitchChat.html#event:part">part</a></li><li><a href="TwitchChat.html#event:raw">raw</a></li><li><a href="TwitchChat.html#event:reconnect">reconnect</a></li><li><a href="TwitchChat.html#event:registered">registered</a></li><li><a href="TwitchChat.html#event:roomstate">roomstate</a></li><li><a href="TwitchChat.html#event:usernotice">usernotice</a></li><li><a href="TwitchChat.html#event:userstate">userstate</a></li><li><a href="TwitchChat.html#event:whisper">whisper</a></li><li><a href="TwPubSub.html#event:automod-approved">automod-approved</a></li><li><a href="TwPubSub.html#event:automod-denied">automod-denied</a></li><li><a href="TwPubSub.html#event:automod-rejected">automod-rejected</a></li><li><a href="TwPubSub.html#event:mod-command">mod-command</a></li></ul></div>
                    </nav>
                </div>
            </div>
            <div class="column is-9-desktop">
                <div class="content" id="main-content-wrapper">
                    <header class="page-title">
                        <p>Source</p>
                        <h1>mod/toolui.js</h1>
                    </header>
                    
                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const {remote} = require('electron')
const {Menu, MenuItem, app, BrowserWindow} = remote
const { substr } = require('stringz')

const TTVTool = require('./tool')
const UIPage = require('./uipage')

const Cockpit = require('./cockpit')
const Overlays = require('./overlay')

let selfWindow = null

/**
 * This module helps control and manage the user interface. You can add
 * viewable pages, menus or display error messages.
 * 
 * @class ToolUI
 * @param {TTVTool} tool
 */
class ToolUI {

	constructor(tool) {
		const self = this

		selfWindow = BrowserWindow.getAllWindows()[0]

		this._tool = tool
		/**
		 * Contains the page name that was open before the current. Has no use anymore.
		 * @member {String}
		 */
		this.pageBefore = ''
		/**
		 * Contains the page name of the current page.
		 * @member {String}
		 */
		this.currentPage = ''
		/**
		 * Contains an array with UIPage elements. Please use addPage() to add pages!
		 * @member {Array&lt;UIPage>}
		 */
		this.pages = []
		/**
		 * When loading this contains the loading HTML element with the animation and stuff.
		 * @member {HTMLElement}
		 */
		this.loadingElement = null

		/**
		 * @private
		 * @member {Array}
		 */
		this.menuTemplate = [
			{
				label: this._tool.i18n.__('File'),
				submenu: [
					{ label: this._tool.i18n.__('Restart'), role: 'reload' },
					{ label: this._tool.i18n.__('DevTools'), role: 'toggledevtools' },
					{ type: 'separator' },
					{ label: 'Version ' + app.getVersion() },
					{ label: this._tool.i18n.__('Quit'), role: 'quit' }
				]
			}
		]

		Menu.setApplicationMenu(Menu.buildFromTemplate(this.menuTemplate))

		this._appendPageViewLinkOnLoad = []
		this._loadingPages = {'global': false}

		/*this.addMenu(this._tool.auth.menu)
		this.addMenu(this._tool.settings.menu)*/

		this.addPage(new Cockpit(this))
		this.addPage(new Overlays(this))

		this._tool.once('load', () => {
			self.openPage(self.pages[0].name)

			let navMenu = document.querySelector('#nav-main-menu')
			self._appendPageViewLinkOnLoad.forEach((pageLink) => {
				navMenu.appendChild(pageLink)
			})
			self._appendPageViewLinkOnLoad = []
			ToolUI.applyRevealEffectToNavigation()

			this.addPage(new class extends UIPage {
				constructor(name) {
					super(name)
					document.querySelector('#nav-about').onclick = () => { self.openPage('About') }
				}
				get showInViewsList() { return false }
				open() { document.querySelector('#content_about').style.display = 'block' }
				close() { document.querySelector('#content_about').style.display = 'none' }
			}('About'));
			this.addPage(new class extends UIPage {
				constructor(name) {
					super(name)
					document.querySelector('#nav-changelog').onclick = () => { self.openPage('Changelog') }
				}
				get showInViewsList() { return false }
				open() {
					document.querySelector('#content_changelog').style.display = 'block'

					let latestKnownVersion = self.tool.settings.getString('changelogversion', '0.3.11')
					if(latestKnownVersion != app.getVersion()) {
						self.tool.settings.setString('changelogversion', app.getVersion())
						let changelogUpdateIndicator =  document.querySelector('#nav-changelog > span.update')
						if(changelogUpdateIndicator != null) {
							changelogUpdateIndicator.parentNode.removeChild(changelogUpdateIndicator)
						}
					}
				}
				close() { document.querySelector('#content_changelog').style.display = 'none' }
			}('Changelog'));
			let latestKnownVersion = self.tool.settings.getString('changelogversion', '0.3.11')
			if(latestKnownVersion != app.getVersion()) {
				let changelogUpdateIndicator =  document.querySelector('#nav-changelog > span.update')
				if(changelogUpdateIndicator == null) {
					changelogUpdateIndicator = document.createElement('span')
					changelogUpdateIndicator.classList.add('update')
					document.querySelector('#nav-changelog').appendChild(changelogUpdateIndicator)
				}
			}
		})

		

		selfWindow.removeAllListeners('enter-full-screen')
		selfWindow.on('enter-full-screen', () => {
			document.querySelector('body').classList.add('fullscreen')
		})
		selfWindow.removeAllListeners('enter-html-full-screen')
		selfWindow.on('enter-html-full-screen', () => {
			document.querySelector('body').classList.add('fullscreen')
		})
		selfWindow.removeAllListeners('leave-full-screen')
		selfWindow.on('leave-full-screen', () => {
			document.querySelector('body').classList.remove('fullscreen')
		})
		selfWindow.removeAllListeners('leave-html-full-screen')
		selfWindow.on('leave-html-full-screen', () => {
			document.querySelector('body').classList.remove('fullscreen')
			selfWindow.setFullScreen(false)
		})

		window.onkeyup = (ev) => {
			if(ev.which == 122) { // F11
				selfWindow.setFullScreen(!selfWindow.isFullScreen())
			} else if(ev.which == 27 &amp;&amp; selfWindow.isFullScreen()) { // Esc
				selfWindow.setFullScreen(false)
			} else if(ev.which == 116) { // F5
				let currPage = this.findPage(this.currentPage)
				if(currPage !== null &amp;&amp; typeof(currPage.refreshPage) === 'function') {
					currPage.refreshPage()
				}
			}
		}
		
	}

	/**
	 * Gives you the main tool module.
	 * 
	 * @private
	 * @readonly
	 * @member {TTVTool}
	 */
	get tool() {
		return this._tool
	}

	/**
	 * Gives you the i18n module.
	 * 
	 * @private
	 * @readonly
	 * @member {i18n-nodejs}
	 */
	get i18n() {
		return this._tool.i18n
	}

	/**
	 * Finds a page by its name.
	 * @param {String} name The name of the page you want
	 * @returns {(null|UIPage)}
	 */
	findPage(name) {
		for(let i = 0; i &lt; this.pages.length; i++) {
			if(this.pages[i].name == name) {
				return this.pages[i]
			}
		}
		return null
	}

	static iconExists(iconname)
	{
		for(let i = 0; i &lt; document.styleSheets.length; i++) {
			let rules = document.styleSheets[i].rules || document.styleSheets[i].cssRules;
			for(let x in rules) {
				if(rules.hasOwnProperty(x) &amp;&amp; typeof rules[x].selectorText == 'string' &amp;&amp; rules[x].selectorText == '.ms-Icon--' + iconname + '::before')
					return true
			}
		}
		return false;
	}

	static applyRevealEffectToNavigation()
	{
		FluentRevealEffect.applyEffect(".side-nav", {
			clickEffect: false,
			lightColor: "rgba(255,255,255,0.4)",
			gradientSize: 120,
			isContainer: true,
			children: {
				borderSelector: "li",
				elementSelector: "a",
				lightColor: "rgba(255,255,255,0.2)",
				gradientSize: 150
			}
		})
	}

	/**
	 * Adds a page and creates a menu entry.
	 * @param {UIPage} page The page you want to add
	 */
	addPage(page) {
		const self = this
		if(page instanceof UIPage &amp;&amp; page.name.length > 0) {
			let lookitup = this.findPage(page.name)
			if(lookitup == null) {
				this.pages.push(page)
				this._loadingPages[page.name] = false
				if(page.showInViewsList) {
					let listElement = document.createElement('li')
					let linkElement = document.createElement('a')
					let iconElement = document.createElement('span')

					if(ToolUI.iconExists(page.icon)) {
						iconElement.classList.add('ms-Icon')
						iconElement.classList.add('ms-Icon--' + page.icon)
					} else {
						iconElement.innerText = substr(page.icon, 0, 1).toUpperCase()
					}
					linkElement.setAttribute('title', page.localizedName)
					linkElement.appendChild(iconElement)
					linkElement.appendChild(document.createTextNode(page.localizedName))
					linkElement.addEventListener('click', () => { self.openPage(page.name) })
					listElement.appendChild(linkElement)

					let navMenu = document.querySelector('#nav-main-menu')
					if(navMenu == null) {
						self._appendPageViewLinkOnLoad.push(listElement)
					} else {
						navMenu.appendChild(listElement)
						ToolUI.applyRevealEffectToNavigation()
					}
					/*let menu = this.getMenuItemById('menu_view')
					menu.submenu.append(new MenuItem({
						label: page.localizedName,
						type: 'radio',
						checked: false,
						click: (mi, bw, e) => { self.openPage(page.name) }
					}))*/
				}
			}
		}
	}

	/**
	 * Opens a page by its name. If no page is found by this name nothing happens.
	 * @param {String} name The name of the page you want to open
	 */
	openPage(name) {
		let page = this.findPage(name)
		if(page != null) {
			let pageCurrentObject = this.findPage(this.currentPage)
			if(pageCurrentObject != null) {
				this._removeLoading()
				pageCurrentObject.close()
			}
			this.pageBefore = this.currentPage
			page.open()
			document.querySelector('title').innerText = 'TTVStreamerTool - ' + page.localizedName
			this.currentPage = page.name
			if(this._loadingPages[page.name] || this._loadingPages['global']) {
				this._createLoading()
			}
		}
	}

	/**
	 * Adds a new menuitem to the application menu.
	 * @param {MenuItem} menuitem The menu item you want to add
	 */
	addMenu(menuitem) {
		Menu.getApplicationMenu().append(menuitem)
		Menu.setApplicationMenu(Menu.getApplicationMenu())
	}

	/**
	 * Finds and returns a menu item by its id. Optionally you can pass
	 * a menu that should be searched. Submenus are being searched automatically.
	 * @param {String} menuitemid The menu item id you want to get
	 * @param {Menu} [menu] The menu that is being searched. If non is given the application menu is searched.
	 * @returns {(null | MenuItem)} Returns null if no menu item with the id is found
	 */
	getMenuItemById(menuitemid, menu) {
		if(typeof(menu) == "undefined")
			menu = Menu.getApplicationMenu()
		var items = menu.items
		for(var i = 0; i &lt; items.length; i++) {
			var submenu = items[i].submenu
			if(submenu != null) {
				var it = this.getMenuItemById(menuitemid, submenu)
				if(it != null)
					return it
			}
			if(items[i].hasOwnProperty('id') &amp;&amp; items[i].id == menuitemid) {
				return items[i]
			}
		}
		return null
	}

	_createLoading()
	{
		if(this.loadingElement != null) return

		this.loadingElement = document.createElement('modal')
		this.loadingElement.innerHTML = '&lt;img src="../res/img/hourglass.gif" alt="" />'
		//document.querySelector('#contents').style.filter = 'blur(3px)'
		document.querySelector('body').appendChild(this.loadingElement)
		riot.mount(this.loadingElement)
	}

	/**
	 * Displays the loading overlay.
	 * @param {UIPage} [page] The page that is currently loading, so the loading screen is only visible for the loading page
	 */
	startLoading(page) {
		if(!(page instanceof UIPage)) page = { name: 'global' }
		this._loadingPages[page.name] = true
		if(this.currentPage == page.name || page.name == 'global') {
			this._createLoading()
		}
	}

	_removeLoading()
	{
		if(this.loadingElement == null) return
		//document.querySelector('#contents').style.filter = ''
		this.loadingElement.parentElement.removeChild(this.loadingElement)
		this.loadingElement = null
	}

	/**
	 * Removes the loading overlay.
	 */
	stopLoading(page) {
		if(!(page instanceof UIPage)) page = { name: 'global' }
		this._loadingPages[page.name] = false
		if(this.currentPage == page.name || (page.name == 'global' &amp;&amp; !this._loadingPages[this.currentPage])) {
			this._removeLoading()
		}
	}

	/**
	 * Creates and displays a error message as an modal overlay and returns the created element.
	 * 
	 * @param {Error} error The error you want to display. If an invalid error is given an unknown error message is shown.
	 * @param {Boolean} [autohide=false]  If this is set to true the message is being hidden after 5 seconds. Defaults to false.
	 * @param {Boolean} [showbutton=true]  If this is set to false the OK button is not displayed. Defaults to true.
	 * @returns {HTMLElement}
	 */
	showErrorMessage(error, autohide, showbutton) {
		if(typeof(autohide) != "boolean") autohide = false
		if(typeof(showbutton) != "boolean") showbutton = true

		//this.stopLoading() // Stop loading
		if(typeof(error) == 'string') error = new Error(error)
		if(error == null || !error.hasOwnProperty('message')) error = new Error(this._tool.i18n.__('Unkown error'))
		if(!autohide) console.error(error)
		const modal = document.createElement('modal')
		modal.innerHTML = error.message.replace('&lt;', '&amp;gt;').replace('>', '&amp;lt;').replace('\n', '&lt;br>') + (showbutton ? '&lt;div style="text-align:center;margin-top:10px;">&lt;button>' + this._tool.i18n.__('OK') + '&lt;/button>&lt;/div>' : '')
		modal.onclick = function() {
			this.parentElement.removeChild(this)
		}
		modal.style.cursor = 'pointer'

		document.getElementsByTagName('body')[0].appendChild(modal)
		riot.mount(modal)

		if(autohide) {
			setTimeout(() => {
				try {
					modal.parentElement.removeChild(modal)
				} catch(e) {
					// Probably already removed
				}
			}, 5000)
		}
		return modal;
	}

}

module.exports = ToolUI</code></pre>
        </article>
    </section>




                </div>
            </div>
        </div>
    </div>

<footer class="footer">
    <div class="content has-text-centered">
        <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Tue Oct 15 2019 17:14:27 GMT+0200 (GMT+02:00)</p>
        <p class="sidebar-created-by">
            <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
            <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
        </p>
    </div>
</footer>

<script src="scripts/app.min.js"></script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
