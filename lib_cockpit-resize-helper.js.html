

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>lib/cockpit-resize-helper.js &bull; TTVStreamerTool</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Muli:100,400,700|Oswald:300|Inconsolata,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
    <link type="text/css" rel="stylesheet" href="styles/app.min.css">
</head>

<body>
    <div id="stickyNavbarOverlay"></div>
    <div class="top-navbar">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                     
                        <img src="img/logomark-white.svg" alt="logo">
                    
                     
                        <h1 class="navbar-item">TTVStreamerTool</h1>
                    
                    <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                 
                <div class="navbar-menu">
                    <div class="navbar-end">
                    
                        <div class="navbar-item">
                            <a href="https://github.com/PakL/TTVStreamerTool" target="_blank">Github</a>
                        </div>
                    
                        <div class="navbar-item">
                            <a href="https://pakl.dev/" target="_blank">pakl.dev</a>
                        </div>
                    
                        <div class="navbar-item">
                            <a href="https://dieweltzockt.de/" target="_blank">Die Welt Zockt</a>
                        </div>
                    
                    </div>
                </div>
                
            </nav>
        </div>
    </div>
    <div class="container">
        <div class="columns">
            <div class="column is-3" id="sidebarNav">
                <div class="sidebar">
                    <nav>
                        <h2><a href="index.html">Home</a></h2><div class="category"><h3>Tutorials</h3><ul><li><a href="tutorial-Getting Started.html">Getting Started</a></li><li><a href="tutorial-Streamdeck Shortcuts.html">Streamdeck Shortcuts</a></li></ul><h3>Classes</h3><ul><li><a href="Addons.html">Addons</a></li><li><a href="Channel.html">Channel</a></li><li><a href="Chat.html">Chat</a></li><li><a href="Cockpit.html">Cockpit</a></li><li><a href="Follows.html">Follows</a></li><li><a href="Overlays.html">Overlays</a></li><li><a href="ToolSettings.html">ToolSettings</a></li><li><a href="ToolUI.html">ToolUI</a></li><li><a href="TTVLogin.html">TTVLogin</a></li><li><a href="TTVTool.html">TTVTool</a></li><li><a href="TwitchChat.html">TwitchChat</a></li><li><a href="TwitchHelix.html">TwitchHelix</a></li><li><a href="TwitchTv.html">TwitchTv</a></li><li><a href="UIPage.html">UIPage</a></li></ul><h3>Events</h3><ul><li><a href="Channel.html#event:channeloffline">channeloffline</a></li><li><a href="Channel.html#event:channelonline">channelonline</a></li><li><a href="Channel.html#event:gamechange">gamechange</a></li><li><a href="Channel.html#event:statuschange">statuschange</a></li><li><a href="Channel.html#event:viewers">viewers</a></li><li><a href="Chat.html#event:autohostingyou">autohostingyou</a></li><li><a href="Chat.html#event:chatmessage">chatmessage</a></li><li><a href="Chat.html#event:cheer">cheer</a></li><li><a href="Chat.html#event:clearchat">clearchat</a></li><li><a href="Chat.html#event:clearuser">clearuser</a></li><li><a href="Chat.html#event:connected">connected</a></li><li><a href="Chat.html#event:hostingyou">hostingyou</a></li><li><a href="Chat.html#event:join">join</a></li><li><a href="Chat.html#event:names">names</a></li><li><a href="Chat.html#event:part">part</a></li><li><a href="Chat.html#event:roomstate">roomstate</a></li><li><a href="Chat.html#event:sendmessage">sendmessage</a></li><li><a href="Chat.html#event:usernotice">usernotice</a></li><li><a href="Chat.html#event:userstate">userstate</a></li><li><a href="Cockpit.html#event:channelleft">channelleft</a></li><li><a href="Cockpit.html#event:channelopen">channelopen</a></li><li><a href="Follows.html#event:follow">follow</a></li><li><a href="Overlays.html#event:command">command</a></li><li><a href="Overlays.html#event:hotkeys-unregistered">hotkeys-unregistered</a></li><li><a href="TTVLogin.html#event:complete">complete</a></li><li><a href="TTVTool.html#event:exit">exit</a></li><li><a href="TTVTool.html#event:load">load</a></li><li><a href="TwitchChat.html#event:action">action</a></li><li><a href="TwitchChat.html#event:autohostingyou">autohostingyou</a></li><li><a href="TwitchChat.html#event:capack">capack</a></li><li><a href="TwitchChat.html#event:clearchat">clearchat</a></li><li><a href="TwitchChat.html#event:clearmsg">clearmsg</a></li><li><a href="TwitchChat.html#event:clearuser">clearuser</a></li><li><a href="TwitchChat.html#event:close">close</a></li><li><a href="TwitchChat.html#event:connect">connect</a></li><li><a href="TwitchChat.html#event:error">error</a></li><li><a href="TwitchChat.html#event:hostingyou">hostingyou</a></li><li><a href="TwitchChat.html#event:incoming">incoming</a></li><li><a href="TwitchChat.html#event:join">join</a></li><li><a href="TwitchChat.html#event:message">message</a></li><li><a href="TwitchChat.html#event:mode">mode</a></li><li><a href="TwitchChat.html#event:mode+">mode+</a></li><li><a href="TwitchChat.html#event:mode-">mode-</a></li><li><a href="TwitchChat.html#event:motd">motd</a></li><li><a href="TwitchChat.html#event:names">names</a></li><li><a href="TwitchChat.html#event:notice">notice</a></li><li><a href="TwitchChat.html#event:outgoing">outgoing</a></li><li><a href="TwitchChat.html#event:part">part</a></li><li><a href="TwitchChat.html#event:raw">raw</a></li><li><a href="TwitchChat.html#event:reconnect">reconnect</a></li><li><a href="TwitchChat.html#event:registered">registered</a></li><li><a href="TwitchChat.html#event:roomstate">roomstate</a></li><li><a href="TwitchChat.html#event:usernotice">usernotice</a></li><li><a href="TwitchChat.html#event:userstate">userstate</a></li><li><a href="TwitchChat.html#event:whisper">whisper</a></li></ul></div>
                    </nav>
                </div>
            </div>
            <div class="column is-9-desktop">
                <div class="content" id="main-content-wrapper">
                    <header class="page-title">
                        <p>Source</p>
                        <h1>lib/cockpit-resize-helper.js</h1>
                    </header>
                    
                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * This is a helper class that manages the resize feature in the cockpit
 * 
 * @ignore
 * @class ResizeDragger
 * @param {HTMLElement} mainContainer The main container that all elements are in and that the elements are sized to.
 * @param {HTMLElement} dragger The element that is being dragged to define the new size.
 * @param {HTMLElement} resizeElement The element that is being resized.
 * @param {HTMLElement[]} spaceMaker Elements that must be resized to make space for the resizeElement.
 */
class ResizeDragger {

	constructor(mainContainer, dragger, resizeElement, spaceMaker)
	{
		this.mainContainer = mainContainer
		this.dragger = dragger
		this.resizeElement = resizeElement
		this.spaceMaker = spaceMaker

		this.dragDirection = 'h'
		this.active = false
		this.currentX = 0
		this.currentY = 0

		this.movementX = 0
		this.movementY = 0

		this.fixAutoscroll = false

		this.loadSettings()

		const self = this
		this._dragStartListener = (e) => { self.dragStart(e) }
		this._dragEndListener = (e) => { self.dragEnd(e) }
		this._dragListener = (e) => { self.drag(e) }
		this._dClickListener = (e) => {
			console.log('[Resize] dbclicked')
			cockpitResizeReset()
			cockpitResizeSave()
		}
		this.mainContainer.addEventListener('mousedown', this._dragStartListener)
		this.mainContainer.addEventListener('mouseup', this._dragEndListener)
		this.mainContainer.addEventListener('mousemove', this._dragListener)
		this.dragger.addEventListener('dblclick', this._dClickListener)
	}

	loadSettings() {
		this.dragger.style.top = Tool.settings.getString(ResizeDragger.getVarNameFor(this.dragger, 'top'), '')
		this.dragger.style.left = Tool.settings.getString(ResizeDragger.getVarNameFor(this.dragger, 'left'), '')
		this.dragger.style.width = Tool.settings.getString(ResizeDragger.getVarNameFor(this.dragger, 'width'), '')
		
		this.resizeElement.style.top = Tool.settings.getString(ResizeDragger.getVarNameFor(this.resizeElement, 'top'), '')
		this.resizeElement.style.left = Tool.settings.getString(ResizeDragger.getVarNameFor(this.resizeElement, 'left'), '')
		this.resizeElement.style.width = Tool.settings.getString(ResizeDragger.getVarNameFor(this.resizeElement, 'width'), '')
		this.resizeElement.style.height = Tool.settings.getString(ResizeDragger.getVarNameFor(this.resizeElement, 'height'), '')
		
		for(let i = 0; i &lt; this.spaceMaker.length; i++) {
			this.spaceMaker[i].style.width = Tool.settings.getString(ResizeDragger.getVarNameFor(this.spaceMaker[i], 'width'), '')
			this.spaceMaker[i].style.height = Tool.settings.getString(ResizeDragger.getVarNameFor(this.spaceMaker[i], 'height'), '')
		}
	}

	/**
	 * Saves settings for the given element, including top, left, height, width
	 * @param {HTMLElement} element
	 */
	static saveSettingsFor(element) {
		ResizeDragger.saveElementProperty(element, 'top')
		ResizeDragger.saveElementProperty(element, 'left')
		ResizeDragger.saveElementProperty(element, 'width')
		ResizeDragger.saveElementProperty(element, 'height')
	}

	static saveElementProperty(element, property) {
		if(typeof(element) === 'undefined') return
		if(typeof(element.style) === 'undefined' || element.style[property] == null || element.style[property].length &lt;= 0) {
			Tool.settings.remove(ResizeDragger.getVarNameFor(element, property))
		} else {
			console.log('[Resize] ' + ResizeDragger.getVarNameFor(element, property) + ' = ' + element.style[property])
			Tool.settings.setString(ResizeDragger.getVarNameFor(element, property), element.style[property])
		}
	}

	/**
	 * Generates a unique variable name for the given element and property depending on the current cockpit view
	 * @param {HTMLElement} element 
	 * @param {string} property 
	 */
	static getVarNameFor(element, property) {
		let prefixes = []
		if(document.querySelector("#content_cockpit").classList.contains('showPlayer'))
			prefixes.push('player')
		if(Tool.settings.showViewerList) prefixes.push('viewers')
		if(Tool.settings.showActionStream) prefixes.push('actions')

		return prefixes.join('_') + '_' + element.getAttribute('id') + '_' + property
	}

	dragStart(e) {
		if (e.target !== this.dragger) return

		this.active = true
		console.log('[Resize] Drag start ' + this.dragger.getAttribute('id'))

		this.currentX = e.clientX;
		this.currentY = e.clientY;

		this.movementX = 0
		this.movementY = 0

		if(getComputedStyle(this.dragger).cursor == 'col-resize') {
			this.dragDirection = 'h'
		} else {
			this.dragDirection = 'v'
		}

		if(Tool.cockpit.chatelement._tag.autoscroll) {
			this.fixAutoscroll = true
		}

		let videoPlayer = document.querySelector('#stream_video webview')
		if(videoPlayer !== null) videoPlayer.style.visibility = 'hidden'
		this.dragger.classList.add('active')
	}

	dragEnd(e) {
		if(!this.active) return
		console.log('[Resize] Drag end ' + this.dragger.getAttribute('id'))

		this.dragger.classList.remove('active')
		this.active = false;
		
		let videoPlayer = document.querySelector('#stream_video webview')
		if(videoPlayer !== null) videoPlayer.style.visibility = 'visible'

		if(this.dragDirection == 'h') {
			this.dragEndHorizontal(e)
		} else if(this.dragDirection == 'v') {
			this.dragEndVertical(e)
		}

		cockpitResizeSave()

		if(this.fixAutoscroll) {
			Tool.cockpit.chatelement._tag.scoll_to_bottom()
		}
	}
	
	dragEndHorizontal(e) {
		// Do not resize a column under 30 pixel width
		if((parseFloat(getComputedStyle(this.resizeElement).width) + this.movementX) &lt; 30) {
			this.movementX = 30 - parseFloat(getComputedStyle(this.resizeElement).width)
		}

		// Do not resize beyond a point where spacemakers can no longer give space
		for(let i = 0; i &lt; this.spaceMaker.length; i++) {
			if(getComputedStyle(this.spaceMaker[i]).visibility != 'visible' || getComputedStyle(this.spaceMaker[i]).display == 'none') continue

			if((parseFloat(getComputedStyle(this.spaceMaker[i]).width) - this.movementX) &lt; 30) {
				this.movementX = (30 - parseFloat(getComputedStyle(this.spaceMaker[i]).width)) * -1
			}
		}

		let left = this.toPercent(parseFloat(getComputedStyle(this.resizeElement).left) - this.movementX)
		let width = this.toPercent(parseFloat(getComputedStyle(this.resizeElement).width) + this.movementX)

		this.resizeElement.style.width = width + '%'
		this.resizeElement.style.left = left + '%'
		this.dragger.style.left = left + '%'

		for(let i = 0; i &lt; this.spaceMaker.length; i++) {
			let width = this.toPercent(parseFloat(getComputedStyle(this.spaceMaker[i]).width) - this.movementX)
			this.spaceMaker[i].style.width = width + '%'
		}
	}

	dragEndVertical(e) {
		// Do not resize a column under 30 pixel height
		if((parseFloat(getComputedStyle(this.resizeElement).height) + this.movementY) &lt; 30) {
			this.movementY = 30 - parseFloat(getComputedStyle(this.resizeElement).height)
		}

		// Do not resize beyond a point where spacemakers can no longer give space
		for(let i = 0; i &lt; this.spaceMaker.length; i++) {
			if(getComputedStyle(this.spaceMaker[i]).visibility != 'visible' || getComputedStyle(this.spaceMaker[i]).display == 'none') continue

			if((parseFloat(getComputedStyle(this.spaceMaker[i]).height) - this.movementY) &lt; 30) {
				this.movementY = (30 - parseFloat(getComputedStyle(this.spaceMaker[i]).height)) * -1
			}
		}

		let top = this.toPercent(parseFloat(getComputedStyle(this.resizeElement).top)-65 - this.movementY, true)
		let height = this.toPercent(parseFloat(getComputedStyle(this.resizeElement).height) + this.movementY, true)

		this.resizeElement.style.height = height + '%'
		this.resizeElement.style.top = 'calc(' + top + '% + 65px)'
		this.dragger.style.top = 'calc(' + top + '% + 65px)'

		for(let i = 0; i &lt; this.spaceMaker.length; i++) {
			let height = this.toPercent(parseFloat(getComputedStyle(this.spaceMaker[i]).height) - this.movementY, true)
			this.spaceMaker[i].style.height = height + '%'
		}
	}
	
	drag(e) {
		if(this.active) {
			e.preventDefault()
				
			let moveX = this.currentX - e.clientX
			let moveY = this.currentY - e.clientY
			this.currentX = e.clientX
			this.currentY = e.clientY

			this.movementX = this.movementX + moveX
			this.movementY = this.movementY + moveY
	
			if(this.dragDirection == 'h') {
				let left = this.toPercent(parseFloat(getComputedStyle(this.dragger).left) - moveX)
				this.dragger.style.left = left + '%'
			} else if(this.dragDirection == 'v') {
				let top = this.toPercent(parseFloat(getComputedStyle(this.dragger).top)-65 - moveY, true)
				this.dragger.style.top = 'calc(' + top + '% + 65px)'
			}
		}
	}

	/**
	 * @ignore
	 * @param {number} value 
	 * @param {boolean} [height]
	 */
	toPercent(value, height) {
		if(typeof(height) !== 'boolean') height = false
		let containerSize = parseFloat(height ? getComputedStyle(this.mainContainer).height : getComputedStyle(this.mainContainer).width)
		return (100 / containerSize * value)
	}

	reset() {
		this.resizeElement.style.width = ''
		this.resizeElement.style.left = ''
		this.resizeElement.style.height = ''
		this.resizeElement.style.top = ''
		this.dragger.style.left = ''
		this.dragger.style.top = ''
		for(let i = 0; i &lt; this.spaceMaker.length; i++) {
			this.spaceMaker[i].style.width = ''
			this.spaceMaker[i].style.height = ''
		}
	}

	cleanup() {
		this.mainContainer.removeEventListener('mousedown', this._dragStartListener)
		this.mainContainer.removeEventListener('mouseup', this._dragEndListener)
		this.mainContainer.removeEventListener('mousemove', this._dragListener)
		this.dragger.removeEventListener('dblclick', this._dClickListener)
	}
}

let cockpitResizeDragger = []

function cockpitResizeReset()
{
	for(let i = 0; i &lt; cockpitResizeDragger.length; i++) {
		cockpitResizeDragger[i].reset()
	}
}

function cockpitResizeSave()
{
	let elements = []
	for(let i = 0; i &lt; cockpitResizeDragger.length; i++) {
		let crd = cockpitResizeDragger[i]
		if(elements.indexOf(crd.dragger) &lt; 0) elements.push(crd.dragger)
		if(elements.indexOf(crd.resizeElement) &lt; 0) elements.push(crd.resizeElement)
		for(let j = 0; j &lt; crd.spaceMaker.length; j++) {
			if(elements.indexOf(crd.spaceMaker[i]) &lt; 0) elements.push(crd.spaceMaker[i])
		}
	}

	for(let i = 0; i &lt; elements.length; i++) {
		ResizeDragger.saveSettingsFor(elements[i])
	}
}

function cockpitResetCleanup()
{
	cockpitResizeReset()
	for(let i = 0; i &lt; cockpitResizeDragger.length; i++) {
		cockpitResizeDragger[i].cleanup()
	}
	cockpitResizeDragger = []

	document.querySelector("#content_cockpit").removeEventListener('wheel', cockpitAdjustFontSize)
	document.querySelector("#content_cockpit").removeEventListener('mouseup', cockpitResetFontSize)
}

/**
 * @ignore
 * @param {WheelEvent} e
 */
function cockpitAdjustFontSize(e) {
	if(e.deltaY != 0 &amp;&amp; e.ctrlKey) {
		e.preventDefault()
		let fontTarget = e.target
		while(['content_cockpit', 'channelchat', 'channeluser', 'channelactions'].indexOf(fontTarget.getAttribute('id')) &lt; 0) {
			fontTarget = fontTarget.parentElement
		}
		if(fontTarget.getAttribute('id') != 'content_cockpit') {
			fontTarget.style.zoom = (parseFloat(getComputedStyle(fontTarget).zoom) - (e.deltaY/1000))
			Tool.settings.setString(ResizeDragger.getVarNameFor(fontTarget, 'zoom'), fontTarget.style.zoom)
		}
	}
}

function cockpitLoadFontSize() {
	document.querySelector('#channelchat').style.zoom = Tool.settings.getString(ResizeDragger.getVarNameFor(document.querySelector('#channelchat'), 'zoom'), '')
	document.querySelector('#channeluser').style.zoom = Tool.settings.getString(ResizeDragger.getVarNameFor(document.querySelector('#channeluser'), 'zoom'), '')
	document.querySelector('#channelactions').style.zoom = Tool.settings.getString(ResizeDragger.getVarNameFor(document.querySelector('#channelactions'), 'zoom'), '')
}

function cockpitResetFontSize(e) {
	if(e.ctrlKey &amp;&amp; e.which == 2) {
		e.preventDefault()
		let fontTarget = e.target
		while(['content_cockpit', 'channelchat', 'channeluser', 'channelactions'].indexOf(fontTarget.getAttribute('id')) &lt; 0) {
			fontTarget = fontTarget.parentElement
		}
		if(fontTarget.getAttribute('id') != 'content_cockpit') {
			fontTarget.style.zoom = ''
			Tool.settings.remove(ResizeDragger.getVarNameFor(fontTarget, 'zoom'))
		}
	}
}

function cockpitResizeInit()
{
	let mainContainer = document.querySelector("#content_cockpit")

	let spaceMakerChoice = [
		[
			document.querySelector('#stream_video')
		],
		[
			document.querySelector('#chat_column'),
			document.querySelector('#stream_video'),
			document.querySelector('#cockpit_chat_resize')
		],
		[
			document.querySelector('#chat_column'),
		],
		[
			document.querySelector('#chat_users_column')
		]
	]


	cockpitResizeDragger = []

	if(mainContainer.classList.contains('showPlayer')) {
		cockpitResizeDragger.push(new ResizeDragger(
			mainContainer,
			document.querySelector("#cockpit_chat_resize"),
			document.querySelector('#chat_column'),
			spaceMakerChoice[0]
		))
		if(Tool.settings.showViewerList) {
			cockpitResizeDragger.push(new ResizeDragger(
				mainContainer,
				document.querySelector("#cockpit_viewers_resize"),
				document.querySelector('#chat_users_column'),
				(Tool.settings.showActionStream ? spaceMakerChoice[1] : spaceMakerChoice[2])
			))
		}
		if(Tool.settings.showActionStream) {
			cockpitResizeDragger.push(new ResizeDragger(
				mainContainer,
				document.querySelector("#cockpit_action_resize"),
				document.querySelector('#cockpit_action_stream'),
				(Tool.settings.showViewerList ? spaceMakerChoice[3] : spaceMakerChoice[2])
			))
		}
	} else {
		if(Tool.settings.showViewerList) {
			cockpitResizeDragger.push(new ResizeDragger(
				mainContainer,
				document.querySelector("#cockpit_viewers_resize"),
				document.querySelector('#chat_users_column'),
				spaceMakerChoice[1]
			))
		}
		if(Tool.settings.showActionStream) {
			cockpitResizeDragger.push(new ResizeDragger(
				mainContainer,
				document.querySelector("#cockpit_action_resize"),
				document.querySelector('#cockpit_action_stream'),
				(Tool.settings.showViewerList ? spaceMakerChoice[3] : spaceMakerChoice[1])
			))
		}
	}

	mainContainer.addEventListener('wheel', cockpitAdjustFontSize)
	mainContainer.addEventListener('mouseup', cockpitResetFontSize)
	cockpitLoadFontSize()
}
</code></pre>
        </article>
    </section>




                </div>
            </div>
        </div>
    </div>

<footer class="footer">
    <div class="content has-text-centered">
        <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.3</a> on Mon Jul 29 2019 17:48:54 GMT+0200 (GMT+02:00)</p>
        <p class="sidebar-created-by">
            <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
            <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers</a>
        </p>
    </div>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/app.min.js"></script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
