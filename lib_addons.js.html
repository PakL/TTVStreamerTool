

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: lib/addons.js | TTVST</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 0px; height: 0px">
        
            <img src="img/toast-ui.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">TTVST</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Tutorials</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Tutorials</h3><ul><li><a href="tutorial-Getting Started.html">Getting Started</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Getting Started_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Addons.html">Addons</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Addons_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Addons.html#menu">menu</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Addons.html#addonInstalled">addonInstalled</a></li><li><a href="Addons.html#findAndReplaceInMessage">findAndReplaceInMessage</a></li><li><a href="Addons.html#getAddon">getAddon</a></li><li><a href="Addons.html#getInstalledAddonDescription">getInstalledAddonDescription</a></li><li><a href="Addons.html#getInstalledAddonVersion">getInstalledAddonVersion</a></li></ul></div></li><li><a href="Channel.html">Channel</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Channel_sub"><div class="member-type">Events</div><ul class="inner"><li><a href="Channel.html#event:channeloffline">channeloffline</a></li><li><a href="Channel.html#event:channelonline">channelonline</a></li><li><a href="Channel.html#event:gamechange">gamechange</a></li><li><a href="Channel.html#event:statuschange">statuschange</a></li><li><a href="Channel.html#event:viewers">viewers</a></li></ul></div></li><li><a href="Chat.html">Chat</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Chat_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Chat.html#connected">connected</a></li><li><a href="Chat.html#irc">irc</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Chat.html#auth">auth</a></li><li><a href="Chat.html#disconnect">disconnect</a></li><li><a href="Chat.html#getUserObjByTags">getUserObjByTags</a></li><li><a href="Chat.html#join">join</a></li><li><a href="Chat.html#openViewercard">openViewercard</a></li><li><a href="Chat.html#part">part</a></li><li><a href="Chat.html#sendmsg">sendmsg</a></li><li><a href="Chat.html#showmsg">showmsg</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="Chat.html#event:autohostingyou">autohostingyou</a></li><li><a href="Chat.html#event:chatmessage">chatmessage</a></li><li><a href="Chat.html#event:cheer">cheer</a></li><li><a href="Chat.html#event:clearchat">clearchat</a></li><li><a href="Chat.html#event:clearuser">clearuser</a></li><li><a href="Chat.html#event:clearuser">clearuser</a></li><li><a href="Chat.html#event:connected">connected</a></li><li><a href="Chat.html#event:hostingyou">hostingyou</a></li><li><a href="Chat.html#event:join">join</a></li><li><a href="Chat.html#event:names">names</a></li><li><a href="Chat.html#event:part">part</a></li><li><a href="Chat.html#event:roomstate">roomstate</a></li><li><a href="Chat.html#event:usernotice">usernotice</a></li><li><a href="Chat.html#event:userstate">userstate</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="Chat.html#~userObject">userObject</a></li></ul></div></li><li><a href="Cockpit.html">Cockpit</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Cockpit_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Cockpit.html#icon">icon</a></li><li><a href="Cockpit.html#isChannelOnline">isChannelOnline</a></li><li><a href="Cockpit.html#localizedName">localizedName</a></li><li><a href="Cockpit.html#name">name</a></li><li><a href="Cockpit.html#openChannelId">openChannelId</a></li><li><a href="Cockpit.html#openChannelObject">openChannelObject</a></li><li><a href="Cockpit.html#showInViewsList">showInViewsList</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Cockpit.html#close">close</a></li><li><a href="Cockpit.html#leaveChannel">leaveChannel</a></li><li><a href="Cockpit.html#loadMoreFollows">loadMoreFollows</a></li><li><a href="Cockpit.html#open">open</a></li><li><a href="Cockpit.html#openChannel">openChannel</a></li><li><a href="Cockpit.html#searchGame">searchGame</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="Cockpit.html#event:channelleft">channelleft</a></li><li><a href="Cockpit.html#event:channelopen">channelopen</a></li></ul></div></li><li><a href="Follows.html">Follows</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Follows_sub"><div class="member-type">Events</div><ul class="inner"><li><a href="Follows.html#event:follow">follow</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="Follows.html#~userObject">userObject</a></li></ul></div></li><li><a href="Overlays.html">Overlays</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Overlays_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Overlays.html#allowedFiles">allowedFiles</a></li><li><a href="Overlays.html#icon">icon</a></li><li><a href="Overlays.html#localizedName">localizedName</a></li><li><a href="Overlays.html#name">name</a></li><li><a href="Overlays.html#overlayport">overlayport</a></li><li><a href="Overlays.html#overlayserver">overlayserver</a></li><li><a href="Overlays.html#showInViewsList">showInViewsList</a></li><li><a href="Overlays.html#wsport">wsport</a></li><li><a href="Overlays.html#wsserver">wsserver</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Overlays.html#appendSetting">appendSetting</a></li><li><a href="Overlays.html#broadcastWsMessage">broadcastWsMessage</a></li><li><a href="Overlays.html#close">close</a></li><li><a href="Overlays.html#disableOverlayHotkeys">disableOverlayHotkeys</a></li><li><a href="Overlays.html#open">open</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="Overlays.html#event:hotkeys-unregistered">hotkeys-unregistered</a></li></ul></div></li><li><a href="ToolSettings.html">ToolSettings</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ToolSettings_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ToolSettings.html#autoRecoverMessages">autoRecoverMessages</a></li><li><a href="ToolSettings.html#displayClassicChat">displayClassicChat</a></li><li><a href="ToolSettings.html#flashActions">flashActions</a></li><li><a href="ToolSettings.html#highlights">highlights</a></li><li><a href="ToolSettings.html#language">language</a></li><li><a href="ToolSettings.html#lightDesignMode">lightDesignMode</a></li><li><a href="ToolSettings.html#menu">menu</a></li><li><a href="ToolSettings.html#showActionStream">showActionStream</a></li><li><a href="ToolSettings.html#showBanAlert">showBanAlert</a></li><li><a href="ToolSettings.html#showCheerAlert">showCheerAlert</a></li><li><a href="ToolSettings.html#showFollowAlert">showFollowAlert</a></li><li><a href="ToolSettings.html#showHostAlert">showHostAlert</a></li><li><a href="ToolSettings.html#showLocalizedNames">showLocalizedNames</a></li><li><a href="ToolSettings.html#showRaidAlert">showRaidAlert</a></li><li><a href="ToolSettings.html#showSubscriptionAlert">showSubscriptionAlert</a></li><li><a href="ToolSettings.html#showTimeoutAlert">showTimeoutAlert</a></li><li><a href="ToolSettings.html#showViewerList">showViewerList</a></li><li><a href="ToolSettings.html#showViewersAmount">showViewersAmount</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ToolSettings.html#addHighlight">addHighlight</a></li><li><a href="ToolSettings.html#appendSetting">appendSetting</a></li><li><a href="ToolSettings.html#getBoolean">getBoolean</a></li><li><a href="ToolSettings.html#getJSON">getJSON</a></li><li><a href="ToolSettings.html#getString">getString</a></li><li><a href="ToolSettings.html#remove">remove</a></li><li><a href="ToolSettings.html#setBoolean">setBoolean</a></li><li><a href="ToolSettings.html#setJSON">setJSON</a></li><li><a href="ToolSettings.html#setLanguage">setLanguage</a></li><li><a href="ToolSettings.html#setString">setString</a></li></ul></div></li><li><a href="ToolUI.html">ToolUI</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ToolUI_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ToolUI.html#currentPage">currentPage</a></li><li><a href="ToolUI.html#loadingElement">loadingElement</a></li><li><a href="ToolUI.html#pageBefore">pageBefore</a></li><li><a href="ToolUI.html#pages">pages</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ToolUI.html#addMenu">addMenu</a></li><li><a href="ToolUI.html#addPage">addPage</a></li><li><a href="ToolUI.html#findPage">findPage</a></li><li><a href="ToolUI.html#getMenuItemById">getMenuItemById</a></li><li><a href="ToolUI.html#openPage">openPage</a></li><li><a href="ToolUI.html#showErrorMessage">showErrorMessage</a></li><li><a href="ToolUI.html#startLoading">startLoading</a></li><li><a href="ToolUI.html#stopLoading">stopLoading</a></li></ul></div></li><li><a href="TTVLogin.html">TTVLogin</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TTVLogin_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TTVLogin.html#menu">menu</a></li><li><a href="TTVLogin.html#userid">userid</a></li><li><a href="TTVLogin.html#username">username</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="TTVLogin.html#auth">auth</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="TTVLogin.html#event:complete">complete</a></li></ul></div></li><li><a href="TTVTool.html">TTVTool</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TTVTool_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TTVTool.html#addons">addons</a></li><li><a href="TTVTool.html#auth">auth</a></li><li><a href="TTVTool.html#channel">channel</a></li><li><a href="TTVTool.html#chat">chat</a></li><li><a href="TTVTool.html#cockpit">cockpit</a></li><li><a href="TTVTool.html#follows">follows</a></li><li><a href="TTVTool.html#i18n">i18n</a></li><li><a href="TTVTool.html#overlays">overlays</a></li><li><a href="TTVTool.html#settings">settings</a></li><li><a href="TTVTool.html#subscriptions">subscriptions</a></li><li><a href="TTVTool.html#twitchapi">twitchapi</a></li><li><a href="TTVTool.html#twitchhelix">twitchhelix</a></li><li><a href="TTVTool.html#ui">ui</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="TTVTool.html#event:exit">exit</a></li><li><a href="TTVTool.html#event:load">load</a></li></ul></div></li><li><a href="TwitchChat.html">TwitchChat</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TwitchChat_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TwitchChat.html#options">options</a></li><li><a href="TwitchChat.html#socket">socket</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="TwitchChat.html#join">join</a></li><li><a href="TwitchChat.html#part">part</a></li><li><a href="TwitchChat.html#say">say</a></li><li><a href="TwitchChat.html#sendCLRF">sendCLRF</a></li></ul><div class="member-type">Events</div><ul class="inner"><li><a href="TwitchChat.html#event:action">action</a></li><li><a href="TwitchChat.html#event:autohostingyou">autohostingyou</a></li><li><a href="TwitchChat.html#event:capack">capack</a></li><li><a href="TwitchChat.html#event:clearchat">clearchat</a></li><li><a href="TwitchChat.html#event:clearmsg">clearmsg</a></li><li><a href="TwitchChat.html#event:clearuser">clearuser</a></li><li><a href="TwitchChat.html#event:close">close</a></li><li><a href="TwitchChat.html#event:connect">connect</a></li><li><a href="TwitchChat.html#event:error">error</a></li><li><a href="TwitchChat.html#event:hostingyou">hostingyou</a></li><li><a href="TwitchChat.html#event:incoming">incoming</a></li><li><a href="TwitchChat.html#event:join">join</a></li><li><a href="TwitchChat.html#event:message">message</a></li><li><a href="TwitchChat.html#event:mode">mode</a></li><li><a href="TwitchChat.html#event:mode+">mode+</a></li><li><a href="TwitchChat.html#event:mode-">mode-</a></li><li><a href="TwitchChat.html#event:motd">motd</a></li><li><a href="TwitchChat.html#event:names">names</a></li><li><a href="TwitchChat.html#event:notice">notice</a></li><li><a href="TwitchChat.html#event:outgoing">outgoing</a></li><li><a href="TwitchChat.html#event:part">part</a></li><li><a href="TwitchChat.html#event:raw">raw</a></li><li><a href="TwitchChat.html#event:registered">registered</a></li><li><a href="TwitchChat.html#event:roomstate">roomstate</a></li><li><a href="TwitchChat.html#event:usernotice">usernotice</a></li><li><a href="TwitchChat.html#event:userstate">userstate</a></li><li><a href="TwitchChat.html#event:whisper">whisper</a></li></ul></div></li><li><a href="TwitchHelix.html">TwitchHelix</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TwitchHelix_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TwitchHelix.html#clientid">clientid</a></li><li><a href="TwitchHelix.html#redirecturi">redirecturi</a></li><li><a href="TwitchHelix.html#scope">scope</a></li><li><a href="TwitchHelix.html#userid">userid</a></li><li><a href="TwitchHelix.html#userobj">userobj</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="TwitchHelix.html#getAuthImplicitGrantFlowUrl">getAuthImplicitGrantFlowUrl</a></li><li><a href="TwitchHelix.html#getAuthToken">getAuthToken</a></li><li><a href="TwitchHelix.html#getGames">getGames</a></li><li><a href="TwitchHelix.html#getStreams">getStreams</a></li><li><a href="TwitchHelix.html#getUsers">getUsers</a></li><li><a href="TwitchHelix.html#getUsersFollows">getUsersFollows</a></li><li><a href="TwitchHelix.html#isLoggedIn">isLoggedIn</a></li><li><a href="TwitchHelix.html#requestAPI">requestAPI</a></li><li><a href="TwitchHelix.html#setAuthToken">setAuthToken</a></li><li><a href="TwitchHelix.html#verifyState">verifyState</a></li></ul></div></li><li><a href="TwitchTv.html">TwitchTv</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TwitchTv_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TwitchTv.html#channelid">channelid</a></li><li><a href="TwitchTv.html#channelobj">channelobj</a></li><li><a href="TwitchTv.html#clientid">clientid</a></li><li><a href="TwitchTv.html#redirecturi">redirecturi</a></li><li><a href="TwitchTv.html#scope">scope</a></li><li><a href="TwitchTv.html#userid">userid</a></li><li><a href="TwitchTv.html#userobj">userobj</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="TwitchTv.html#getAuthImplicitGrantFlowUrl">getAuthImplicitGrantFlowUrl</a></li><li><a href="TwitchTv.html#getAuthToken">getAuthToken</a></li><li><a href="TwitchTv.html#getChannel">getChannel</a></li><li><a href="TwitchTv.html#getChannelFollowers">getChannelFollowers</a></li><li><a href="TwitchTv.html#getChannelSubscribers">getChannelSubscribers</a></li><li><a href="TwitchTv.html#getChannelVideos">getChannelVideos</a></li><li><a href="TwitchTv.html#getChatBadgesByChannel">getChatBadgesByChannel</a></li><li><a href="TwitchTv.html#getChatBadgeSetsByChannel">getChatBadgeSetsByChannel</a></li><li><a href="TwitchTv.html#getChatEmoticonsBySet">getChatEmoticonsBySet</a></li><li><a href="TwitchTv.html#getCheermotes">getCheermotes</a></li><li><a href="TwitchTv.html#getCollectionsByChannel">getCollectionsByChannel</a></li><li><a href="TwitchTv.html#getStreamByUser">getStreamByUser</a></li><li><a href="TwitchTv.html#getTeam">getTeam</a></li><li><a href="TwitchTv.html#getUser">getUser</a></li><li><a href="TwitchTv.html#getUserByName">getUserByName</a></li><li><a href="TwitchTv.html#getUserFollows">getUserFollows</a></li><li><a href="TwitchTv.html#isLoggedIn">isLoggedIn</a></li><li><a href="TwitchTv.html#requestAPI">requestAPI</a></li><li><a href="TwitchTv.html#searchGames">searchGames</a></li><li><a href="TwitchTv.html#setAuthToken">setAuthToken</a></li><li><a href="TwitchTv.html#updateChannel">updateChannel</a></li><li><a href="TwitchTv.html#verifyState">verifyState</a></li></ul></div></li><li><a href="UIPage.html">UIPage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="UIPage_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="UIPage.html#icon">icon</a></li><li><a href="UIPage.html#localizedName">localizedName</a></li><li><a href="UIPage.html#name">name</a></li><li><a href="UIPage.html#showInViewsList">showInViewsList</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="UIPage.html#close">close</a></li><li><a href="UIPage.html#open">open</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict"

const {shell, remote} = require('electron')
const {app} = remote.require('electron')
const {spawn, spawnSync, execSync} = require('child_process');
const fs = require("fs")
const Path = require('path')
const https = require("../node_modules/follow-redirects").https
const UIPage = require('../mod/uipage')
const i18n_module = require('i18n-nodejs')
const compVer = require('compare-versions')

/**
 * This module finds addons, loads and initialze them
 * 
 * @param {TTVTool} tool
 * @class Addons
 */
class Addons extends UIPage {

	constructor(tool) {
		super('Addons');

		this.tool = tool

		this.addons = []
		this.addonnames = []
		this.package_infos = {}
		this.available_addons = []
		this.possibleAddon = ''
		this.addonsFolder = Path.resolve(process.cwd(), './addons')

		let curdir = fs.realpathSync('.')
		let addonsDir = []
		try {
			fs.accessSync('addons')
			let addonsDird = fs.readdirSync('addons')

			for(let i = 0; i &lt; addonsDird.length; i++)
				addonsDir.push('addons/' + addonsDird[i])
		} catch(e) {}
		try {
			fs.accessSync('resources')
			let resourcesDir = fs.readdirSync('resources')

			this.addonsFolder = Path.resolve(process.cwd(), './resources')
			for(let i = 0; i &lt; resourcesDir.length; i++)
				addonsDir.push('resources/' + resourcesDir[i])
		} catch(e) {}

		console.log('[Addons] Checking addons: ' + addonsDir.join(', '))
		
		let infos = {}
		let lang = null
		this.incompatibleAddonsFound = false
		for(let i = 0; i &lt; addonsDir.length; i++) {
			infos = {}
			lang = null
			try {
				fs.accessSync(`${addonsDir[i]}/package.json`)
				fs.accessSync(`${addonsDir[i]}/addon.js`)

				let pack = fs.readFileSync(`${addonsDir[i]}/package.json`, { encoding: 'utf8' })
				infos = JSON.parse(pack)
			} catch(e) {}
			try {
				fs.accessSync(`${addonsDir[i]}/language.json`)
				lang = new i18n_module(this.tool.settings.language, `${curdir}/${addonsDir[i]}/language.json`)
			} catch(e) {}

			if(infos.hasOwnProperty('name') &amp;&amp; infos.hasOwnProperty('systems')) {
				if(infos.systems.indexOf(process.platform) >= 0) {
					let toolversionNeeded = '0.3.5'
					if(infos.hasOwnProperty('toolversion')) {
						toolversionNeeded = infos.toolversion
					}

					if(compVer(toolversionNeeded, app.getVersion()) >= 0) {
						try {
							let addon = require(`${curdir}/${addonsDir[i]}/addon`)
	
							this.addons.push(new addon(this.tool, lang))
							console.log('[Addons] Addon ' + addonsDir[i] + ' is being loaded')
							this.addonnames.push(infos.name)
							infos.file = `${curdir}/${addonsDir[i]}`
							this.package_infos[infos.name] = infos
						} catch(e) {
							console.log('Error loading addon ' + addonsDir[i])
							console.error(e)
						}
	
					} else {
						console.log('[Addons] Addon ' + addonsDir[i] + ' is not compatible with the current version')
						this.incompatibleAddonsFound = true

						this.addonnames.push(infos.name)
						infos.file = `${curdir}/${addonsDir[i]}`
						infos.description = this.tool.i18n.__('Incompatible version "{{version}}". Current TTVST version: {{packageversion}}', {'version': toolversionNeeded, 'packageversion': app.getVersion()})
						this.package_infos[infos.name] = infos
					}
				} else {
					console.log('[Addons] Addon ' + addonsDir[i] + ' is not compatible with the current platform')
					this.incompatibleAddonsFound = true

					this.addonnames.push(infos.name)
					infos.file = `${curdir}/${addonsDir[i]}`
					infos.description = this.tool.i18n.__('Incompatible platforms "{{platform}}"', {'platform': JSON.stringify(infos.systems)})
					this.package_infos[infos.name] = infos
				}
			} else {
				console.log('[Addons] Addon ' + addonsDir[i] + ' has no platform informations')
			}
		}

		const self = this
		this.tool.on('load', () => {
			for(let i = 0; i &lt; self.addons.length; i++) {
				if(self.addons[i] instanceof UIPage) {
					self.tool.ui.addPage(self.addons[i])
				}
			}
			self.loadPackages()

			self.tool.ui.addPage(self)
			document.querySelector('#nav-addons').onclick = () => { self.tool.ui.openPage(self.name) }

			if(self.incompatibleAddonsFound) {
				self.tool.ui.showErrorMessage(new Error(self.tool.i18n.__('Some addons were found to be incompatible with the current version of TTVStreamerTool.\nPlease check if there\'s an update available for your addons.')))
			}
		})
	}

	/**
	 * Checks if an addon is installed
	 * 
	 * @param {String} name Name of the addon
	 * @returns {Boolean}
	 */
	addonInstalled(name) {
		if(this.addonnames.indexOf(name) >= 0) {
			return true
		}
		return false
	}

	/**
	 * Returns the version of the installed addon
	 * 
	 * @param {String} name Name of the addon
	 * @returns {String} Version of the addon or 'Unkown' if not installed or not defined
	 */
	getInstalledAddonVersion(name) {
		if(typeof(this.package_infos[name]) == "undefined" || typeof(this.package_infos[name].version) == "undefined") {
			return "Unkown"
		}
		return this.package_infos[name].version
	}

	/**
	 * Returns the description of the installed addon
	 * 
	 * @param {String} name Name of the addon
	 * @returns {String} Description of the addon or 'No description' if not installed or not defined
	 */
	getInstalledAddonDescription(name) {
		if(typeof(this.package_infos[name]) == "undefined" || typeof(this.package_infos[name].description) == "undefined") {
			return "No description"
		}
		return this.package_infos[name].description
	}

	/**
	 * Gets the addon by name
	 * 
	 * @param {String} name Name of the addon
	 * @returns {(null|Object)} Either the addon module or null when not found
	 */
	getAddon(name) {
		let i = this.addonnames.indexOf(name)
		if(i >= 0) {
			return this.addons[i]
		}
		return null
	}

	/**
	 * Gives you a new instance of the addons menu
	 * 
	 * @type {MenuItem}
	 * @readonly
	 */
	get menu() {
		const self = this

		let m = []
		let update = false
		for(let i = 0; i &lt; this.available_addons.length; i++) {
			let a = this.available_addons[i]
			let mi = {
				label: a.name + ' (v' + (this.addonInstalled(a.name) ? this.getInstalledAddonVersion(a.name) : a.version)+ ')',
				type: 'checkbox',
				checked: this.addonInstalled(a.name),
				click: () => { self.addonclick(a.name) }
			}
			m.push(mi)

			if(this.addonInstalled(a.name)) {
				if(self.getInstalledAddonVersion(a.name) != a.version) {
					update = true
					self.possibleAddon = a.name
				}
			}
		}
		if(update) {
			m.push({type: 'separator'})
			m.push({label: 'Update available. Update now!', click: () => { self.updateclick() }})
		}

		return new MenuItem({
			label: 'Addons',
			submenu: Menu.buildFromTemplate(m)
		})
	}

	generateTable() {
		const self = this
		
		let tableBody = document.querySelector('#content_addons table > tbody')
		tableBody.innerHTML = ''

		let prepRow = () => {
			let tableRow = document.createElement('tr')
			let nameColumn = document.createElement('td')
			let descriptionColumn = document.createElement('td')
			let versionColumn = document.createElement('td')
			let installedColumn = document.createElement('td')
			let installedButton = document.createElement('button')
			installedColumn.style.textAlign = 'right'
			tableRow.appendChild(nameColumn)
			tableRow.appendChild(descriptionColumn)
			tableRow.appendChild(versionColumn)
			tableRow.appendChild(installedColumn)
			tableBody.appendChild(tableRow)

			return [nameColumn, descriptionColumn, versionColumn, installedColumn, installedButton]
		}

		let m = []
		let update = false
		let onlineAddons = []
		for(let i = 0; i &lt; this.available_addons.length; i++) {
			let a = this.available_addons[i]

			let nameColumn, descriptionColumn, versionColumn, installedColumn, installedButton
			[nameColumn, descriptionColumn, versionColumn, installedColumn, installedButton] = prepRow()

			onlineAddons.push(a.name)
			nameColumn.innerText = a.name
			descriptionColumn.innerText = (self.getInstalledAddonDescription(a.name) == 'No description' ? a.description : self.getInstalledAddonDescription(a.name))
			versionColumn.innerText = 'v' + a.version

			if(this.addonInstalled(a.name)) {
				let installedVersion = self.getInstalledAddonVersion(a.name)
				installedButton.innerText = 'v' + installedVersion +' (' + self.tool.i18n.__('Remove') + ')'
				if(installedVersion != a.version) {
					update = true
					self.possibleAddon = a.name
				}
				installedButton.onclick = () => { self.addonclick(a.name) }
			} else {
				installedButton.innerText = self.tool.i18n.__('Install now')
				installedButton.onclick = () => { self.addonclick(a.name) }
			}
			installedColumn.appendChild(installedButton)
		}

		for(let i = 0; i &lt; this.addonnames.length; i++) {
			let an = this.addonnames[i]
			if(onlineAddons.indexOf(an) >= 0) continue;

			let nameColumn, descriptionColumn, versionColumn, installedColumn, installedButton
			[nameColumn, descriptionColumn, versionColumn, installedColumn, installedButton] = prepRow()

			nameColumn.innerText = an
			descriptionColumn.innerText = self.getInstalledAddonDescription(an)
			versionColumn.innerText = 'v' + self.getInstalledAddonVersion(an)
			installedColumn.innerText = self.tool.i18n.__('Manually')
		}

		let tfoot = document.createElement('tfoot')
		let footRow = document.createElement('tr')
		let footColumn = document.createElement('td')
		footColumn.setAttribute('colspan', '4')
		
		let folderButton = document.createElement('button')
		folderButton.innerText = self.tool.i18n.__('Open addons folder')
		folderButton.onclick = () => { shell.openItem(self.addonsFolder) }
		footColumn.appendChild(folderButton)
		
		if(update) {
			let updateButton = document.createElement('button')
			updateButton.innerText = self.tool.i18n.__('Update available. Update now!')
			updateButton.onclick = () => { self.updateclick() }
			footColumn.appendChild(updateButton)

			let addonUpdateIndicator =  document.querySelector('#nav-addons > span.update')
			if(addonUpdateIndicator == null) {
				addonUpdateIndicator = document.createElement('span')
				addonUpdateIndicator.classList.add('update')
				document.querySelector('#nav-addons').appendChild(addonUpdateIndicator)
			}
		}

		footRow.appendChild(footColumn)
		tfoot.appendChild(footRow)

		tableBody.parentNode.appendChild(tfoot)
	}

	static getRetryDeleteSnippet(file) {
		return ':LOOP\r\ndel "' + file + '"\r\nIF EXIST "' + file + '" (\r\ntimeout /T 1 /Nobreak >nul\r\nGOTO LOOP\r\n)\r\n'
	}

	/**
	 * (Un)installs an addon
	 * 
	 * @private
	 * @param {String} addonname Name of the addon
	 */
	addonclick(addonname) {
		if(this.addonInstalled(addonname)) {
			if(this.package_infos[addonname].file.endsWith('.asar')) {
				let modal = this.tool.ui.showErrorMessage(new Error(this.tool.i18n.__('Uninstalling {{addon}} now... Program will restart.', {addon: addonname})), false, false)
				modal.onclick = () => {}
				setTimeout(() => {
					fs.writeFileSync('deleteAddon.bat', '@echo off\r\n' + Addons.getRetryDeleteSnippet(this.package_infos[addonname].file.replace(/\//g, '\\')) + '"\r\nstart "" "' + process.execPath + '"\r\nexit')
					spawn('start', ['deleteAddon.bat'], {cwd: process.cwd(), env: process.env, shell: true, detached: true, windowsHide: false })
					app.quit()
				}, 5000);
			} else {
				this.tool.ui.showErrorMessage(new Error(this.tool.i18n.__('Cannot uninstall. For uninstall the addon must be a asar addon.', {addon: addonname})))
			}
		} else {
			let downloadurl = ''
			for(let i = 0; i &lt; this.available_addons.length; i++) {
				let a = this.available_addons[i]
				if(addonname == a.name) {
					downloadurl = a.url
				}
			}
			if(downloadurl.length > 0) {
				let modal = this.tool.ui.showErrorMessage(new Error(this.tool.i18n.__('Downloading and installing {{addon}} now... Program will restart.', {addon: addonname})), false, false)
				modal.onclick = () => {}

				https.get(downloadurl, (resp) => {
					if(resp.statusCode == 200) {
						fs.writeFileSync('resources/' + addonname + '.part', Buffer.alloc(0))
						resp.on('data', (chunk) => { fs.appendFileSync('resources/' + addonname + '.part', chunk) })
						resp.on('end', () => {
							fs.renameSync('resources/' + addonname + '.part', 'resources/' + addonname + '.asar')
							app.relaunch()
							app.quit()
						})
					} else {
						app.quit()
					}
				})
			} else {
				this.tool.ui.showErrorMessage(new Error(this.tool.i18n.__('Could not find anything to download.')))
			}
		}
	}

	/**
	 * Updates a addon and restarts
	 * 
	 * @private
	 */
	updateclick() {
		const self = this
		let addonname = this.possibleAddon
		if(addonname.length &lt;= 0) return
		let downloadurl = ''
		for(let i = 0; i &lt; this.available_addons.length; i++) {
			let a = this.available_addons[i]
			if(addonname == a.name) {
				downloadurl = a.url
			}
		}
		if(downloadurl.length > 0) {
			let modal = this.tool.ui.showErrorMessage(new Error(this.tool.i18n.__('Downloading and updating {{addon}} now... Program will restart.', {addon: addonname})), false, false)
			modal.onclick = () => {}

			https.get(downloadurl, (resp) => {
				if(resp.statusCode == 200) {
					fs.writeFileSync('resources/' + addonname + '.part', Buffer.alloc(0))
					resp.on('data', (chunk) => { fs.appendFileSync('resources/' + addonname + '.part', chunk) })
					resp.on('end', () => {
						fs.writeFileSync('updateAddon.bat', '@echo off\r\n' + Addons.getRetryDeleteSnippet(this.package_infos[addonname].file.replace(/\//g, '\\')) + '"\r\ncopy resources\\' + addonname + '.part resources\\' + addonname + '.asar\r\ndel resources\\' + addonname + '.part\r\nstart "" "' + process.execPath + '"\r\nexit')
						spawn('start', ['updateAddon.bat'], {cwd: process.cwd(), env: process.env, shell: true, detached: true, windowsHide: false })
						app.quit()
					})
				} else {
					app.quit()
				}
			})
		} else {
			this.tool.ui.showErrorMessage(new Error(this.tool.i18n.__('Could not find anything to download.')))
		}
	}

	/**
	 * Loads all available packages
	 * 
	 * @private
	 */
	loadPackages() {
		const self = this
		let tableBody = document.querySelector('#content_addons table > tbody')
		tableBody.innerHTML = `&lt;tr>&lt;td colspan="4" style="text-align:center">${self.tool.i18n.__('Loading, please wait...')}&lt;/td>&lt;/tr>`
		https.get('https://vs.paklweb.de/ttvst/addons.php', (res) => {
			if(res.statusCode == 200) {
				res.setEncoding('utf8')
				let addons_json = ''
				res.on('data', (chunk) => { addons_json += chunk })
				res.on('end', () => {
					try {
						let addons = JSON.parse(addons_json)
						self.available_addons = addons
						//self.tool.ui.addMenu(self.menu)
						self.generateTable()
					} catch(e) {
						tableBody.innerHTML = `&lt;tr>&lt;td colspan="4" style="text-align:center">${self.tool.i18n.__('Could not load addon information.')}&lt;/td>&lt;/tr>`
						console.error(e)
					}
				})
			} else {
				tableBody.innerHTML = `&lt;tr>&lt;td colspan="4" style="text-align:center">${self.tool.i18n.__('Could not load addon information.')}&lt;/td>&lt;/tr>`
			}
		}).on('error', () => {
			tableBody.innerHTML = `&lt;tr>&lt;td colspan="4" style="text-align:center">${self.tool.i18n.__('Could not load addon information.')}&lt;/td>&lt;/tr>`
		})
	}

	/**
	 * Takes a message and searches for addons which have a findAndReplaceInMessage function.
	 * Those addons are then able to parse the message and replace some parts (e.g. emotes)
	 * 
	 * @param {string} message 
	 * @returns {Array}
	 */
	findAndReplaceInMessage(message)
	{
		let replacings = []
		for(let i = 0; i &lt; this.addons.length; i++) {
			if(typeof(this.addons[i].findAndReplaceInMessage) === 'function') {
				let rep = this.addons[i].findAndReplaceInMessage(message)
				if(Array.isArray(rep)) {
					replacings = replacings.concat(rep)
				}
			}
		}
		return replacings
	}

	get localizedName() {
		return this._name
	}
	get showInViewsList() {
		return false
	}
	open() {
		document.querySelector('#content_addons').style.display = 'block';
	}
	close() {
		document.querySelector('#content_addons').style.display = 'none';
	}

}
module.exports = Addons</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="img/toast-ui.png" style="width: 0px; height: 0px">
    <div class="footer-text">Code by PakL</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
